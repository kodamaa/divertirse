<div id="header">
  <%= link_to 'home', posts_path %> | <%= link_to 'new', new_post_path %>
</div>

<div id="notice"><%= notice %></div>

<h1>記事一覧</h1>

<table id="posts-table">
<tr>
    <th>タイトル</th>
    <th>投稿者</th>
    <th>投稿日</th>
    <th>カテゴリ</th>
    <th>コメント</th>
    <th> </th>
</tr>
<% @posts.each do |post| %>
<% category = getCategory(post.category_id) %>
<tr id="post_<%= post.id %>" class="post-<%= category.color %>">
    <td><%= link_to post.title, post_path(post) %></td>
    <td><%= getUserName(post.user_id) %></td>
    <td><%= post.created_at.strftime("%Y/%m/%d %H:%M") %></td>
    <td class="post-category"><%= category.category_name %></td>
    <td>(<%= post.comments.size %>)</td>
    <td><%= link_to 'Edit', edit_post_path(post) %>
        <%= link_to 'Delete', post, :confirm => "sure",
                            :method => :delete,
                            :remote => :true %></td>
</tr>
<% end %>
</table>
<%= paginate @posts %>
<script>
$(function(){
	setTimeout(function(){
		$('#notice').fadeOut("slow");
	},800);

    $('a[data-method="delete"]').on('ajax:success', function(e, data, status, xhr) {
    $('#post_'+data.post.id).fadeOut("slow");
    }
	);
	
});
</script>
